<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>íšŒì›ê°€ì…_2</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-size: 0.9rem;
      }

      main {
        padding: 30px;
      }

      .form-container {
        margin: 0 auto;
        padding: 20px;
        width: 300px;
        min-width: 300px;
        border: 1px solid #f0f0f0;
      }

      .form-container fieldset {
        margin-bottom: 10px;
        border: none;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .form-container legend {
        margin-bottom: 10px;
      }

      .form-container input,
      .form-container button,
      .form-container #error {
        padding: 5px;
        width: 100%;
        border: 1px solid #bebebe;
      }

      .form-container #error {
        background-color: rgb(239, 239, 239);
        display: none;
      }

      .form-container #user-count {
        min-height: 20px;
        color: #8c8c98;
        text-align: center;
        font-size: 1rem;
        font-weight: 700;
      }
    </style>
  </head>
  <body>
    <main>
      <div class="form-container">
        <form>
          <fieldset>
            <legend>ğŸ‘¤ ì‚¬ìš©ì ìƒì„±</legend>
            <input type="text" id="userName" name="userName" placeholder="ì´ë¦„" />
            <input type="password" id="userPassword" name="userPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" />
            <button type="button" onclick="User.create()">ì‚¬ìš©ì ë§Œë“¤ê¸°</button>
          </fieldset>

          <fieldset>
            <legend>ğŸ” ë¹„ë°€ë²ˆí˜¸ í™•ì¸</legend>
            <input type="password" id="confirm-password" name="confirm-password" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" />
            <button type="button" onclick="User.checkPassword()">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</button>
          </fieldset>

          <fieldset>
            <legend>ğŸ“Š ì „ì²´ ì‚¬ìš©ì ìˆ˜ í™•ì¸</legend>
            <p id="user-count">í˜„ì¬ ì‚¬ìš©ì ìˆ˜</p>
            <button type="button" onclick="User.showCount()">í˜„ì¬ ìƒì„±ëœ ì‚¬ìš©ì ìˆ˜ ë³´ê¸°</button>
          </fieldset>

          <p id="error"></p>
        </form>
      </div>
    </main>

    <script>
      const ERRORS = {
        NO_NAME: 'âŒ ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.',
        NAME_VALIDITY: 'âŒ ì´ë¦„ì€ 2ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.',
        NO_PASSWORD: 'âŒ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.',
        NO_NAME_AND_PASSWORD: 'âŒ ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.',
        NO_CURRENT_USER: 'âŒ ë¨¼ì € ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ì„¸ìš”.',
        NO_INPUT_PASSWORD: 'âŒ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.',
        PASSWORD_VALIDITY: 'âŒ ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.',
        PASSWORD_MISMATCH: 'âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦½ë‹ˆë‹¤.',
      };

      class User {
        static count = 0;
        static currentUser = null;

        #password = '';
        _name = '';

        constructor(name, password) {
          this.name = name;
          this.#password = password;
          User.count++;
        }

        get name() {
          return this._name.toUpperCase();
        }

        set name(value) {
          if (value.length < 2) throw new Error(ERRORS.NAME_VALIDITY);
          this._name = value;
        }

        checkPassword(inputPassword) {
          return this.#password === inputPassword;
        }

        static showMessage(text, isError = true) {
          const messageBox = document.getElementById('error');
          messageBox.textContent = text;
          messageBox.style.color = isError ? 'red' : 'green';
          messageBox.style.display = messageBox ? 'block' : 'none';
        }

        static create() {
          const name = document.getElementById('userName').value.trim();
          const password = document.getElementById('userPassword').value;

          if (!name) return this.showMessage(ERRORS.NO_NAME);
          if (!password) return this.showMessage(ERRORS.NO_PASSWORD);
          if (password.length < 6) return this.showMessage(ERRORS.PASSWORD_VALIDITY);

          try {
            User.currentUser = new User(name, password);
            /**í´ë˜ìŠ¤ê°€ ê°ì²´ì²˜ëŸ¼ ë™ì‘í•˜ë¯€ë¡œ, ì •ì  ì†ì„±ì¸ currentUserì— ìƒˆ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥
             * ì•„ë˜ì™€ ë™ì¼í•œ íš¨ê³¼
             * function User() {  }
             * User.currentUser = null;
             *
             * ì• ì´ˆì— UserëŠ” í´ë˜ìŠ¤ = í•¨ìˆ˜í˜• ê°ì²´ë¡œ ê°ì²´ì²˜ëŸ¼ ì‚¬ìš©ì´ ê°€ëŠ¥í•¨
             * ser.currentUserëŠ” User.prototype.currentUserê°€ ì•„ë‹ˆë¼, User.currentUserì— ì†ì„±ì´ ìˆë‹¤ëŠ” ëœ»
             * console.log(User.currentUser.name); ì´ë ‡ê²Œ ì ‘ê·¼ ê°€ëŠ¥
             */

            this.showMessage(`âœ… ì‚¬ìš©ì ${User.currentUser.name} ìƒì„± ì™„ë£Œ!`);
          } catch (err) {
            this.showMessage(`âŒ ${err.message}`);
          }
        }

        static checkPassword() {
          const inputPw = document.getElementById('confirm-password').value;

          if (!inputPw) return this.showMessage(ERRORS.NO_PASSWORD);
          if (!User.currentUser) return showMessage(ERRORS.NO_CURRENT_USER);

          const isMatch = User.currentUser.checkPassword(inputPw);
          showMessage(isMatch ? 'âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤!' : ERRORS.PASSWORD_MISMATCH, !isMatch);
        }

        static getCount() {
          return this.count;
        }

        static showCount() {
          document.getElementById('user-count').textContent = `í˜„ì¬ ì‚¬ìš©ì ìˆ˜: ${this.getCount()}ëª…`;
        }
      }
    </script>
  </body>
</html>
